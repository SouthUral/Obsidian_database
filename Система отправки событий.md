[[Проекты]]

### Задача
Нужна событийная система, сервисы должны отправлять событие, другие сервисы могут эти события перехватывать для своей логики. Так же нужна система для хранения событий

### Основные компоненты
- Сервис сохранения всех сообщений;
	- сервис создает Exchange (1 или 2)
	- этот сервис имеет свою БД и записывает туда все события;
	- в теории он может выдать эти события обратно в событийную систему;
- Rabbit c exchange;
- Отправители (отправляют сообщения `события` в RabbitMQ);
- Получатели (получают сообщения из RabbitMQ)

### Этапы решения задачи
1. [ ] Сделать общий репозиторий гитхаб и гитлаб для работы над проектом с работы и из дома;
2. [ ] Настроить docker-compose.yml с контейнером RabbitMQ;
3. [ ] Сделать тестовый сервис, в котором будут запускаться отправители и получатели. Далее этот сервис будет использоваться для теста при внедрении других решений;
	1. [ ] Сделать замер скорости _от отправления до получения_ (нужно для понимания эффективности);
	2. [ ] Сделать замер последовательности _(Для получателя каждое последующее событие должно быть младше предыдущего, т.е. чтобы старое событие не пришло быстрее более нового события)_
	3. Сделать структуру сообщений для отправления, у одного отправителя может быть несколько типов события, тип события не принадлежит отправителю;
		1. Нужно выбрать _routing key_ или заголовки;
			1. на текущий момент два тега:
				1. Отправитель;
				2. Тип события;
		2. Тело сообщения;
	4. Сделать функцию _Отправитель_;
	5. Сделать _генератор сообщений_;
	6. Сделать функцию _Получатель_;
4. Реализовать 5 типов получателей:
	1. [ ] Получает все события от одного отправителя;
	2. [ ] Получает только события одного _(нескольких)_ типа _(от любых отправителей)_;
	3. [ ] Получает от одного отправителя тип 1, от другого отправителя тип 2;
	4. [ ] Получает все сообщения от нескольких отправителей;
	5. [ ] Получает все события от всех.
5. [ ] Запустить тестовый сервис и проверить работу всех типов получателей;
6. [ ] Сделать сервис по сохранению сообщений в БД (версия сервиса, которая просто подписывается на все события от всех отправителей и сохраняет их в БД)
	1. [ ] Реализовать модуль инициализации __Exchange__;
	2. [ ] Модуль подключения к Rabbit и чтения сообщений;
	3. [ ] Модуль записи сообщений в Базу;
	4. [ ] Сделать тесты (по усмотрению);
7. [ ] Протестировать вариант с сохранением сообщений (здесь будет создаваться еще одна очередь в которую будут идти все события);
	1. [ ] Нужно протестировать, все ли сообщения попадут в БД;
8. [ ] Сделать сервис но уже с роутом сообщений. Создается Exchange в который все отправители будут кидать события, далее к Exchange подключается одна очередь, которая считывает все сообщения, очередь слушает сервис, он параллельно отправляет прослушанные сообщения в другой Exchange уже для получателей, и так же еще записывает эти сообщения в БД.
	1. [ ] Модуль подключения к Rabbit _(модуль должен выдавать подключения и закрывать их если нужно)_
	2. [ ] Модуль подписчик на Rabbit _(должен читать все сообщения)_;
	3. [ ] Модуль работы с БД _(нужно записывать все сообщения в БД)_;
		1. [ ] Работа с подключением к БД _(подключение, отключение, закрытие, переподключение)_;
		2. [ ] Запись в БД;
		3. [ ] Чтение из БД;
	4. [ ] Придумать систему при которой можно остановить поток любых событий на время _(под потоком подразумевается передача события напрямую от Rabbit в Rabbit)_
		1. [ ] Нужно сделать типы остановок, все остановки потоков должны прекращаться, т.е. поток должен возобновится, все остановки должны быть низкоуровневыми, т.е. доступ к ним осуществляется через какое-либо API:
			- Остановить поток от одного _(или нескольких)_ отправителя;
			- Остановить поток одного _(или нескольких)_ типов;
			- Остановить поток определенного типа _(одного или нескольких)_ и определенного отправителя _(одного или нескольких)_;
		2. [ ] Остановка потока нужна для  отправки событий из БД _(допустим 10 последних событий типа 1 и 2 от отправителя 1)_. Отправка событий из истории можно включать через REST API